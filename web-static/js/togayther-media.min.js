function previewChanged(e){$("#previewCropX").val(e.x);$("#previewCropY").val(e.y);$("#previewCropW").val(e.w);$("#previewCropH").val(e.h)}function initPreview(){$("#preview-image").Jcrop({onChange:previewChanged,onSelect:previewChanged,aspectRatio:2.1428},function(){jcrop_api=this});$("#formMediaKey").val($("#mediaKey").val())}function initAddMedia(){$("input:file").change(function(){uploadFile()});$("#constrainRatio").change(function(){if(jcrop_api){jcrop_api.setOptions(this.checked?{aspectRatio:2.083}:{aspectRatio:0})}})}function uploadProgress(e){if(e.lengthComputable){var t=Math.round(e.loaded*100/e.total);$("#progress").css("width",t.toString()+"%").attr("aria-valuenow",t);if(t<100){$("#progress").html(t.toString()+"%")}else{$("#progress").html("Processing...")}}else{}}function uploadComplete(e){$(".image-preview").html(e.currentTarget.response);$("#progress-container").toggleClass("active");$("#progress-container").toggleClass("progress-stripped");document.getElementById("progress").innerHTML="Done";initPreview()}function uploadFailed(e){alert("There was an error attempting to upload the file.")}function uploadCanceled(e){alert("The upload has been canceled by the user or the browser dropped the connection.")}function uploadFile(){var e=new XMLHttpRequest;var t=new FormData(document.getElementById("addMediaForm"));e.upload.addEventListener("progress",uploadProgress,false);e.addEventListener("load",uploadComplete,false);e.addEventListener("error",uploadFailed,false);e.addEventListener("abort",uploadCanceled,false);e.open("POST","/addMedia.action");e.send(t)}var jcrop_api