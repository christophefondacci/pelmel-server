function call(e,t){jQuery.get(e,null,function(e){$("#"+t).html(e);Pelmel.bindForms()})}function clearPoints(e){for(var t in e){e[t].setMap(null)}}function computeCentralPoint(e){return computeBounds(e).getCenter()}function computeBounds(e){var t=new google.maps.LatLngBounds;for(var n in e){var r=e[n].position;if(r.lat()!=0&&r.lng()!=0){t.extend(e[n].position)}}return t}function setfocus(e,t){if(t==e.value){e.value=""}}function lostfocus(e,t){if(trim(e.value)==""){e.value=t}}function trim(e){return e.replace(/^\s+/g,"").replace(/\s+$/g,"")}function check(e){var t=e.id;var n=t.substring(t.indexOf("-")+1);var r=$("#"+n);var i=r.attr("checked");r.attr("checked",!i);$(e).parent().toggleClass("search-facet-selected")}function checkCommentTag(e,t){$("#tag-"+e).toggleClass("selected-tag");call(t,null)}function bindDefaultOverlays(){}function moveMedia(e){jQuery.get(e,null,function(e){$(".profile-media-container, .images").html(e);Pelmel.handleMediaList();initOverlays()})}function lookup(e){jQuery.get(e,null,function(e){document.getElementById("cityDefinition").innerHTML=e})}function like(e,t){$("#likeaction").attr("src","/images/loading.gif");call(e,t)}function waitCall(e,t,n){$(n).html("<img border='0' height='24' src='/images/loading.gif' alt='Loading...'/>");call(e,t)}function createGMap(){shadowIcon=new google.maps.MarkerImage("/images/markers/shadow-marker.png",new google.maps.Size(40,36),new google.maps.Point(0,0),new google.maps.Point(12,32));geocoder=new google.maps.Geocoder;var e=document.getElementById("place-edit-lat").value;var t=document.getElementById("place-edit-lng").value;var n=document.getElementById("placeType").value;point=new google.maps.LatLng(e,t);var r={zoom:16,center:point,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true,zoomControl:true};placeMap=new google.maps.Map(document.getElementById("place-map"),r);var i=new google.maps.MarkerImage("/images/markers/"+n+"-marker.png",new google.maps.Size(24,32),new google.maps.Point(0,0),new google.maps.Point(12,32));placeMarker=new google.maps.Marker({position:new google.maps.LatLng(e,t),icon:i,shadow:shadowIcon,map:placeMap,draggable:true});google.maps.event.addListener(placeMarker,"dragend",function(){document.getElementById("place-edit-lat").value=placeMarker.getPosition().lat();document.getElementById("place-edit-lng").value=placeMarker.getPosition().lng();document.getElementById("place-address").value="";geocode()})}function geocode(e){geocoder=new google.maps.Geocoder;$("#place-edit-spinner").html("<img border='0' height='15' src='/images/loading.gif' alt='Loading...'/>");var t=$("#place-address").val();var n=$("#city").val();var r=t+", "+n;geocoder.geocode({address:r},function(t,n){$("#place-edit-spinner").html("");if(n==google.maps.GeocoderStatus.OK){var r=t[0].geometry.location;$("#place-edit-lat").val(r.lat());$("#place-edit-lng").val(r.lng())}e()})}function mosaicInfo(e,t,n){$("#info-"+t+"-"+n).css("top: "+document.getElementById("cursorY").value);$("#info-"+t+"-"+n).css("left: "+document.getElementById("cursorX").value);$("#info-"+t+"-"+n).toggle()}function addProperty(e,t){var n=$("#"+e+"-template");var r=n.html();var i=$("#"+e+"-container");var s=Number(i.height())+Number(t);var o=s+"px";i.append(r);i.animate({height:o},500)}function handleDialogs(){$(".tag").click(function(){check(this)});$(".control-add").click(function(){var e=this.id;var t=e.substring(0,e.indexOf("-"));var n=e.substring(e.lastIndexOf("-")+1);addProperty(t,n)});$("input#city").typeahead([{remote:"/ajaxSuggestCity.action?type=CITY&term=%QUERY",valueKey:"userLabel",template:"<p><img src='{{imageUrl}}'><strong>{{mainText}}</strong> - {{suffix}}</p>",engine:Hogan}]);$("input#city").on("typeahead:selected",function(e,t){$("#cityValue").val(t.value)});$("input#place").typeahead([{name:"Places",remote:"/ajaxSuggestCity.action?type=PLAC&term=%QUERY",valueKey:"userLabel",template:"<p><img src='{{imageUrl}}'><strong>{{mainText}}</strong> - {{suffix}}</p>",engine:Hogan}]);$("input#place").on("typeahead:selected",function(e,t){$("#placeId").val(t.value)});$("input#startDate").datepicker({format:"yyyy/mm/dd"});$("input#endDate").datepicker({format:"yyyy/mm/dd"});$("#update-place-form").submit(function(e){if(!placeSubmit){placeSubmit=true;geocode(function(){$("#update-place-form").submit()});return false}else{return true}})}function showAction(e){$(".action-map-controls").css("opacity","1");var t=0;var n=1;if(e){t=1;n=0;$(".action-map-container").css("display","block");$("#map-controls").css("display","block");google.maps.event.trigger(map,"resize")}else{$(".action-image-container").css("display","block");$("#img-controls").css("display","block")}$(".action-map-container").animate({opacity:t},300);$("#map-controls").animate({opacity:t},300);$("#img-controls").animate({opacity:n},300);$(".action-image-container").animate({opacity:n},300,function(){if(e){$(".action-image-container").css("display","none");$("#img-controls").css("display","none")}else{$(".action-map-container").css("display","none");$("#map-controls").css("display","none")}})}function hideAllActions(){var e=function(){$(".action-map-controls").css("display","none");$(".action-image-container").css("display","none");$(".action-map-container").css("display","none")};$(".action-map-controls").animate({opacity:0},300,e);$(".action-map-container").animate({opacity:0},300,e);$(".action-image-container").animate({opacity:0},300,e)}function initOverlays(){$("body").on("hidden.bs.modal",".modal",function(e){$(this).removeData("bs.modal");$(e.target).find(".modal-content > *").remove()});$("body").on("loaded.bs.modal",".modal",function(){handleDialogs();initAddMedia()})}function handleMyMessages(){$(".msg-user").click(function(){$("#msg-contents").html("<img border='0' height='15' src='/images/loading.gif' alt='Loading...'/>");var e=$(this).attr("href");jQuery.get(e,null,function(e){$("#msg-contents").html(e);Pelmel.bindForms()});return false});$(".pagination").click(function(){$(this).html("<img border='0' height='15' src='/images/loading.gif' alt='Loading...'/>");var e=$(this).attr("href");jQuery.get(e,null,function(e){$("#msg-list").html(e);handleMyMessages()});return false})}function initialize(){}var placeSubmit=false;var point;var shadowIcon;var geocoder;var placeMarker;var placeMap;var Pelmel={markersarray:[],map:{},imageOverlay:false,initTooltips:function(){if(!Pelmel.mobileDetect.any()){$(".search-tooltip").each(function(){$(this).parent().eq(0).hoverIntent({timeout:150,over:function(){var e=$(".search-tooltip:eq(0)",this);e.fadeIn(100)},out:function(){var e=$(".search-tooltip:eq(0)",this);e.fadeOut(100)}})})}initOverlays()},initMap:function(e){var t={zoom:e.zoom,center:e.center,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true,zoomControl:true,scaleControl:true,streetViewControl:true};var n=document.getElementById("map");if(n){Pelmel.map=new google.maps.Map(n,t);Pelmel.infowindow=new google.maps.InfoWindow({content:"Loading..."})}Pelmel.handleSearch()},allMarkers:[],clearMap:function(){for(var e=0;e<Pelmel.allMarkers.length;e++){Pelmel.allMarkers[e].setMap(null)}Pelmel.allMarkers.length=0;Pelmel.markersarray.length=0},zIndex:0,addPoint:function(e,t,n,r,i,s,o,u){var a=new google.maps.Marker({position:new google.maps.LatLng(e,t),title:n,icon:r,shadow:i,map:Pelmel.map,pelmelItemKey:o,zIndex:Pelmel.zIndex++});if(!u){Pelmel.markersarray.push(a)}Pelmel.allMarkers.push(a);google.maps.event.addListener(a,"click",function(){jQuery.get(s?s:"/mapInfo.action?geoKey="+o,null,function(e){Pelmel.infowindow.setContent(e);Pelmel.infowindow.open(Pelmel.map,a)})})},mapTimer:function(){if(!Pelmel.mapTimerIndex){Pelmel.map.setZoom(10);Pelmel.mapTimerIndex=0}if(Pelmel.markersarray.length>0){var e=Pelmel.markersarray[Pelmel.mapTimerIndex];var t=e.getPosition();Pelmel.map.panTo(t);var n=$("#activity-"+e.pelmelItemKey);var r=n.position().top;var i=n.height();var s=parseInt(n.css("margin-top"));var o=n.parent().scrollTop();var u=n.parent().height()-i;if(r+s>u){n.parent().animate({scrollTop:u+o})}else if(Pelmel.mapTimerIndex==0){n.parent().animate({scrollTop:0})}$("#activity-highlighter").animate({top:r+s+o+"px",height:i});$("#activity-highlighter > .highlight-caret").animate({top:(i-25)/2});Pelmel.lastMarkerKey=e.pelmelItemKey}Pelmel.mapTimerIndex=(Pelmel.mapTimerIndex+1)%Pelmel.markersarray.length;Pelmel.mapTimerVar=setTimeout(function(){Pelmel.mapTimer()},5e3)},bindDropdowns:function(e,t){enlargeEnabled=true;minimizeEnabled=false;$(document).ready(function(){Pelmel.handleMapControls();Pelmel.handleSearch()})},handleDropDown:function(e,t,n,r){if(t){var i=t.lastIndexOf("-");if(i>0){var s=t.substring(i+1);var o=t.indexOf("-");if(o==i){o=-1}var u=t.substring(o+1,i);if(u!="menu"){$("#"+t).each(function(){jQuery.get("/ajaxGeoList.action?type="+n+"&subType="+r+"&parent="+s+"&level="+u,null,function(t){var n=e;n.html("");jQuery.each(t,function(){var e=this.label;if(this.label.length>20){e=this.label.substring(0,20)+"..."}n.append("<li class='geo-option'><a href='"+this.url+"'>"+e+"<span class='li-count'>"+this.value+"</span></a></li>")});Pelmel.handleDropDownLinks()})})}}}},handleDropDownLinks:function(){$(".dropdown a").hover(function(){$(this).stop(true).animate({paddingLeft:"8px"},{speed:100,easing:"easeOutBack"})},function(){$(this).stop(true).animate({paddingLeft:"0"},{speed:100,easing:"easeOutBounce"})})},initOverview:function(){Pelmel.initToolbar();$(".tile-info").each(function(){$(this).parent().eq(0).hoverIntent({timeout:150,over:function(){var e=$(".tile-info:eq(0)",this);e.fadeIn(100)},out:function(){var e=$(".tile-info:eq(0)",this);e.fadeOut(100)}})});Pelmel.handleMediaList()},handleMediaList:function(){$(".user-media").hoverIntent({timeout:0,over:function(){$(".media-actions",this).fadeIn(50)},out:function(){$(".media-actions",this).fadeOut(50)}})},initToolbar:function(){initOverlays();$(".tool-pictures").click(function(){var e=$("div.ov-image").css("background-size");if(e==="cover"){$("div.ov-image").css("background-size","contain")}else{$("div.ov-image").css("background-size","cover")}showAction(false)});$(".tool-tmap").click(function(){showAction(true)});$(".tool-tmsg").click(function(){$(".msg-instant-container").show()});$(".msg-instant-cancel").click(function(){$(".msg-instant-container").hide();return false});$("a[rel='ajax-image']").click(function(e){e.preventDefault();jQuery.get("/ajaxMedia.action?id="+this.id,null,function(e){if(!Pelmel.imageOverlay){$("#image-container-1").html(e).animate({opacity:1},300);$("#image-container").animate({opacity:0},300)}else{$("#image-container").html(e);$("#image-container-1").animate({opacity:0},300);$("#image-container").animate({opacity:1},300)}Pelmel.imageOverlay=!Pelmel.imageOverlay})});if(!Pelmel.mobileDetect.any()){$(".tool").tooltip()}},bindForms:function(){var e={target:".msg-instant-container",url:"/ajaxSendMsg.action",success:function(e,t,n,r){$(".msg-instant-container").hide()}};jQuery("#sendMsg").ajaxForm(e);e={target:"#msg-contents",url:"/ajaxSendFullMsg.action",success:function(e,t,n,r){Pelmel.bindForms()}};jQuery("#sendFullMsg").ajaxForm(e);e={target:"#instantUserMsg",beforeSubmit:function(e,t,n){$("#instant-post-spinner").html("<img class='nextIcon' height='15' src='/images/loading.gif' alt='Loading...'/>")},url:"/ajaxSendInstantMsg.action",success:function(e,t,n,r){Pelmel.bindForms()}};jQuery("#instantMsgForm").ajaxForm(e);e={target:"#comments-contents",url:"/postComment.action",beforeSubmit:function(e,t,n){$("#comment-post-spinner").html("<img border='0' height='15' src='/images/loading.gif' alt='Loading...'/>")},success:function(e,t,n,r){Pelmel.bindForms()}};$("#comment-post-form").ajaxForm(e)},bindLike:function(e){$("#like").click(function(){jQuery.get(e,null,function(){var e=$("#like");e.toggleClass("like-selected");var t=$("#like-count");var n=parseInt(t.html());if(e.is(".like-selected")){t.html(n+1)}else{t.html(n-1)}})})},handleMapControls:function(){$(".map-enlarge").click(function(){if(enlargeEnabled){center=Pelmel.map.getCenter();enlargeEnabled=false;$(".action-map-container").animate({"padding-left":"0px",width:"90%",top:"-335px",height:"256px"},200,function(){google.maps.event.trigger(map,"resize");Pelmel.map.setCenter(center);minimizeEnabled=true})}});$(".map-minimize").click(function(){if(minimizeEnabled){center=Pelmel.map.getCenter();minimizeEnabled=false;$(".action-map-container").animate({right:"10px",width:"190px",top:"-275px",height:"196px"},200,function(){google.maps.event.trigger(map,"resize");Pelmel.map.setCenter(center);enlargeEnabled=true})}});$(".map-close").click(hideAllActions)},handleSearch:function(){var e=$("input#searchType").val();Pelmel.autocompleteSearch(e,"search-geo");Pelmel.autocompleteSearch(e,"home-search-geo")},labels:{com:{Cities:"Cities",Places:"Venues","search.noResult":"No result found.","search.title":"Results"},fr:{Cities:"Villes",Places:"Lieux","search.noResult":"Aucun résultat trouvé.","search.title":"Résultats"}},decodeString:function(e){var t=location.host.lastIndexOf(".");if(t>=0&&t<location.host.length-1){var n=location.host.substring(t+1);var r=Pelmel.labels[n];if(!r){r=Pelmel.labels["com"]}var i=r[e];if(i){return i}else{return e}}},autocompleteDatums:{PLAC:{labelCode:"Places",remote:"/ajaxSuggestCity.action?type=PLAC&term=%QUERY",valueKey:"userLabel",header:"<h3 class='search-section-title'>Places</h3>",template:"<p><img src='{{imageUrl}}'><strong>{{mainText}}</strong> - {{suffix}}</p>",engine:Hogan,limit:5},CITY:{labelCode:"Cities",remote:"/ajaxSuggestCity.action?type=CITY&term=%QUERY",valueKey:"userLabel",header:"<h3 class='search-section-title'>Cities</h3>",template:"<p><img src='{{imageUrl}}'><strong>{{mainText}}</strong> - {{suffix}}</p>",engine:Hogan,limit:6}},autocompleteSearch:function(e,t,n){var r=[];if(n){r=[Pelmel.autocompleteDatums[n]]}else{r=[Pelmel.autocompleteDatums["PLAC"],Pelmel.autocompleteDatums["CITY"]]}for(var i=0;i<r.length;i++){r[i].header="<h3 class='search-section-title'>"+Pelmel.decodeString(r[i].labelCode)+"</h3>"}$("input#"+t).typeahead(r);$("input#"+t).on("typeahead:selected",function(e,t){window.location=t.url})},displayMsg:function(){var e=document.getElementById("instantMsg").style.display;if(e=="inline"){document.getElementById("instantMsg").style.display="none"}else{document.getElementById("instantMsg").style.display="inline"}},refreshMessages:function(e){var t=setTimeout("Pelmel.msgCall('/ajaxInstantRefreshTitle.action','instantMsgTitle',"+e+");",e);var n=$("#hasMsg").html();if(n=="false"){var r=$("#pageStyle").val();var i="/ajaxInstantRefreshBody.action";if(r!=null){i=i+"?pageStyle="+r}Pelmel.simpleCall(i,"instantMsgBody")}},msgCall:function(e,t,n){jQuery.get(e,null,function(e){$("#"+t).html(e);Pelmel.refreshMessages(n)})},bindSendMsg:function(){options={target:"#mainContent",url:"postMessage.action",beforeSubmit:function(e,t,n){$("#message-post-spinner").html("<img border='0' height='15' src='/images/loading.gif' alt='Loading...'/>")},success:function(e,t,n,r){Pelmel.bindForms();Pelmel.bindSendMsg()}};$("#message-post-form").ajaxForm(options)},simpleCall:function(e,t){jQuery.get(e,null,function(e){$("#"+t).html(e);Pelmel.bindForms()})},msgInit:function(){if($("#hasMsg").length>0){Pelmel.refreshMessages(1e4)}},initSlideshow:function(e){var t=$(e);var n=t.children();if(t.length>0&&n.length>0){t.jqFancyTransitions({position:"top",direction:"left",width:750,height:312,navigation:true,links:true})}},mobileDetect:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return Pelmel.mobileDetect.Android()||Pelmel.mobileDetect.BlackBerry()||Pelmel.mobileDetect.iOS()||Pelmel.mobileDetect.Opera()||Pelmel.mobileDetect.Windows()}},centerImageVertically:function(){},focusComment:function(e){$("#comment-text").addClass("focused-comment")},blurComment:function(e){if(trim(e.value)==""){$("#comment-text").removeClass("focused-comment")}},handleSearch:function(){$("input.pelmel-search").keyup(function(e){if(Pelmel.searchTimer){clearTimeout(Pelmel.searchTimer);Pelmel.searchTarget=e.target}Pelmel.searchTimer=setTimeout(function(){var e=$(Pelmel.searchTarget).val();Pelmel.search(e)},300)})},search:function(e){var t=$("#activity-contents");var n=$("#search-title");if(e.length>2){if(Pelmel.lastSearch==e.trim()){return}if(!Pelmel.noSearchHtml){Pelmel.noSearchHtml=t.html();Pelmel.noSearchTitle=n.html();Pelmel.noSearchMarkers=Pelmel.allMarkers.slice(0)}t.html("<div class='wait'><img src='/images/V3/wait.gif'></div>");jQuery.get("/ajaxSuggestCity?filterEmptyCities=true&term="+encodeURIComponent(e),null,function(e){var t="";n.html(Pelmel.decodeString("search.title"));if(e&&e.length>0){var r="";var i=Pelmel.buildMapPointer();Pelmel.clearMap();clearTimeout(Pelmel.mapTimerVar);for(var s=0;s<e.length;s++){var o=e[s];if(o.mainText&&o.suffix){t+='<div class="media"><a class="pull-left" href="';t+=o.url;t+='"><img class="activity-thumb" src="';if(o.imageUrl){r=o.imageUrl}else{r="/images/V2/no-photo-small.png"}t+=r;t+='"></a>';t+='<div class="media-body"><div class="activity-body">';t+='<a class="activity-user" href="';t+=o.url;t+='">'+o.mainText+"</a>";t+="</div>";t+='<span class="timestamp">';t+=o.suffix;t+="</span>";t+="</div></div>";var u=Pelmel.buildMapThumbMarker(r);Pelmel.addPoint(o.lat,o.lng,o.mainText,u,null,o.url,o.value);Pelmel.addPoint(o.lat,o.lng,null,i,null,null,o.value,true)}}Pelmel.map.fitBounds(computeBounds(Pelmel.markersarray))}else{t=Pelmel.decodeString("search.noResult")}$("#activity-contents").html(t)})}else{if(Pelmel.noSearchHtml){t.html(Pelmel.noSearchHtml);n.html(Pelmel.noSearchTitle);Pelmel.clearMap();for(var r=0;r<Pelmel.noSearchMarkers.length;r++){Pelmel.noSearchMarkers[r].setMap(Pelmel.map)}Pelmel.allMarkers=Pelmel.noSearchMarkers.slice(0);Pelmel.map.fitBounds(computeBounds(Pelmel.allMarkers))}}Pelmel.lastSearch=e.trim();if(Pelmel.searchTimer){clearTimeout(Pelmel.searchTimer);Pelmel.searchTimer=null}},buildMapThumbMarker:function(e){return{url:e,size:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,20),scaledSize:new google.maps.Size(30,30)}},buildMapPointer:function(){return{url:"/images/V3/mapMarkerFg.png",size:new google.maps.Size(34,40),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,20)}}}